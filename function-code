import azure.functions as func
import os
import requests
import json

def main(req: func.HttpRequest) -> func.HttpResponse:
    user_message = req.params.get("message")

    if not user_message:
        return func.HttpResponse(
            "Please pass ?message=hello",
            status_code=400
        )

    endpoint = os.getenv("OPENAI_ENDPOINT")
    api_key = os.getenv("OPENAI_API_KEY")

    url = f"{endpoint}/openai/responses?api-version=2024-08-01-preview"

    headers = {
        "Content-Type": "application/json",
        "api-key": api_key
    }

    payload = {
        "model": "gpt-4o-mini",
        "input": user_message,
        "max_output_tokens": 150
    }

    response = requests.post(url, headers=headers, json=payload)

    if response.status_code != 200:
        return func.HttpResponse(
            f"OpenAI error: {response.text}",
            status_code=500
        )

    data = response.json()
    reply = data.get("output_text", "No response")

    return func.HttpResponse(reply, status_code=200)




    -----------------------------------------------------------------
requirement.txt

    azure-functions
    requests

